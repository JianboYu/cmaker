ENABLE_LANGUAGE(C ASM)
SET(avce_src_c
    "common/ih264_resi_trans_quant.c"
    "common/ih264_iquant_itrans_recon.c"
    "common/ih264_ihadamard_scaling.c"
    "common/ih264_inter_pred_filters.c"
    "common/ih264_luma_intra_pred_filters.c"
    "common/ih264_chroma_intra_pred_filters.c"
    "common/ih264_padding.c"
    "common/ih264_mem_fns.c"
    "common/ih264_deblk_edge_filters.c"
    "common/ih264_deblk_tables.c"
    "common/ih264_cavlc_tables.c"
    "common/ih264_cabac_tables.c"
    "common/ih264_common_tables.c"
    "common/ih264_trans_data.c"
    "common/ih264_buf_mgr.c"
    "common/ih264_dpb_mgr.c"
    "common/ih264_list.c"
    "common/ithread.c"
    "encoder/ih264e_globals.c"
    "encoder/ih264e_intra_modes_eval.c"
    "encoder/ih264e_half_pel.c"
    "encoder/ih264e_mc.c"
    "encoder/ih264e_me.c"
    "encoder/ih264e_rc_mem_interface.c"
    "encoder/ih264e_time_stamp.c"
    "encoder/ih264e_modify_frm_rate.c"
    "encoder/ih264e_rate_control.c"
    "encoder/ih264e_core_coding.c"
    "encoder/ih264e_deblk.c"
    "encoder/ih264e_api.c"
    "encoder/ih264e_process.c"
    "encoder/ih264e_encode.c"
    "encoder/ih264e_utils.c"
    "encoder/ih264e_version.c"
    "encoder/ih264e_bitstream.c"
    "encoder/ih264e_cavlc.c"
    "encoder/ih264e_cabac_init.c"
    "encoder/ih264e_cabac.c"
    "encoder/ih264e_cabac_encode.c"
    "encoder/ih264e_encode_header.c"
    "encoder/ih264e_function_selector_generic.c"
    "encoder/ih264e_fmt_conv.c"
    "encoder/irc_rate_control_api.c"
    "encoder/irc_bit_allocation.c"
    "encoder/irc_cbr_buffer_control.c"
    "encoder/irc_est_sad.c"
    "encoder/irc_fixed_point_error_bits.c"
    "encoder/irc_frame_info_collector.c"
    "encoder/irc_mb_model_based.c"
    "encoder/irc_picture_type.c"
    "encoder/irc_rd_model.c"
    "encoder/irc_vbr_storage_vbv.c"
    "encoder/irc_vbr_str_prms.c"
    "encoder/ime.c"
    "encoder/ime_distortion_metrics.c")

if (ARCH_x86_64)
  SET(ARCH_CFLAGS "-DX86 -msse4.2")
  SET(ARCH "x86")
  
  SET(avce_src_arch_c
      "encoder/x86/ih264e_function_selector.c"
      "encoder/x86/ih264e_function_selector_sse42.c"
      "encoder/x86/ih264e_function_selector_ssse3.c"
      "encoder/x86/ih264e_half_pel_ssse3.c"
      "encoder/x86/ih264e_intra_modes_eval_ssse3.c"
      "encoder/x86/ime_distortion_metrics_sse42.c"
      "common/x86/ih264_iquant_itrans_recon_ssse3.c"
      "common/x86/ih264_iquant_itrans_recon_dc_ssse3.c"
      "common/x86/ih264_ihadamard_scaling_ssse3.c"
      "common/x86/ih264_inter_pred_filters_ssse3.c"
      "common/x86/ih264_mem_fns_ssse3.c"
      "common/x86/ih264_padding_ssse3.c"
      "common/x86/ih264_luma_intra_pred_filters_ssse3.c"
      "common/x86/ih264_chroma_intra_pred_filters_ssse3.c"
      "common/x86/ih264_deblk_chroma_ssse3.c"
      "common/x86/ih264_deblk_luma_ssse3.c"
      "common/x86/ih264_iquant_itrans_recon_sse42.c"
      "common/x86/ih264_ihadamard_scaling_sse42.c"
      "common/x86/ih264_resi_trans_quant_sse42.c"
      "common/x86/ih264_weighted_pred_sse42.c")
elseif(ARCH_arm)
  SET(ARCH_CFLAGS "-DARM")
  SET(ARCH "arm")
  #ENABLE_LANGUAGE(C ASM)
 
  SET(avce_src_arch_c
      "encoder/arm/ih264e_function_selector.c")

  if(ARCH_ARM_HAVE_NEON)
    SET(avce_src_arch "${avce_src_arch}"
      "encoder/arm/ih264e_function_selector_a9q.c"
      "common/arm/ih264_resi_trans_quant_a9.s"
      "common/arm/ih264_iquant_itrans_recon_a9.s"
      "common/arm/ih264_iquant_itrans_recon_dc_a9.s"
      "common/arm/ih264_ihadamard_scaling_a9.s"
      "common/arm/ih264_deblk_chroma_a9.s"
      "common/arm/ih264_deblk_luma_a9.s"
      "common/arm/ih264_intra_pred_chroma_a9q.s"
      "common/arm/ih264_intra_pred_luma_16x16_a9q.s"
      "common/arm/ih264_intra_pred_luma_4x4_a9q.s"
      "common/arm/ih264_intra_pred_luma_8x8_a9q.s"
      "common/arm/ih264_inter_pred_chroma_a9q.s"
      "common/arm/ih264_inter_pred_filters_luma_horz_a9q.s"
      "common/arm/ih264_inter_pred_filters_luma_vert_a9q.s"
      "common/arm/ih264_inter_pred_luma_bilinear_a9q.s"
      "common/arm/ih264_inter_pred_luma_copy_a9q.s"
      "common/arm/ih264_padding_neon.s"
      "common/arm/ih264_mem_fns_neon.s"
      "encoder/arm/ih264e_evaluate_intra16x16_modes_a9q.s"
      "encoder/arm/ih264e_evaluate_intra4x4_modes_a9q.s"
      "encoder/arm/ih264e_evaluate_intra_chroma_modes_a9q.s"
      "encoder/arm/ih264e_half_pel.s"
      "encoder/arm/ih264e_fmt_conv.s"
      "encoder/arm/ime_distortion_metrics_a9q.s")

  else(ARCH_ARM_HAVE_NEON) #No Neon
    SET(ARCH_CFLAGS "${ARCH_CFLAGS} -DDISABLE_NEON")
  endif() #Neon check

  SET(avce_src_arch_asm "common/arm/ih264_arm_memory_barrier.s")

else(ARCH_ARM64)
endif ()

INCLUDE_DIRECTORIES(./encoder ./common ./encoder/${ARCH}/ ./common/${ARCH}/)
MESSAGE(INFO " libavcenc ARCH_INCLUDES: ${ARCH_INCLUDES}")
MESSAGE(INFO " libavcenc ASM_COMPILER: ${CMAKE_ASM_COMPILER}")
MESSAGE(INFO " libavcenc ASM_EXTENSIONS: ${CMAKE_ASM_SOURCE_FILE_EXTENSIONS}")

ADD_LIBRARY(libavcenc STATIC ${avce_src_c} ${avce_src_arch_c} ${avce_src_arch_asm})

SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${CMAKE_PRJ_C_FLAGS} ${ARCH_CFLAGS} -DNDEBUG -UHP_PL -DN_MB_ENABLE -fPIC -O3")
MESSAGE(INFO " libavcenc CMAKE_CXX_FLAGS: ${CMAKE_CXX_FLAGS}")
MESSAGE(INFO " libavcenc CMAKE_C_FLAGS: ${CMAKE_C_FLAGS}")
SET_TARGET_PROPERTIES(libavcenc PROPERTIES OUTPUT_NAME "avcenc")

ADD_SUBDIRECTORY(test)
